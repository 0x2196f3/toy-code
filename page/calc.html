<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific & Programmer Calculator</title>
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark-mode');
        }
    </script>
    <style>
        :root {
            --bg-light: #f5f5f5;
            --surface-light: #ffffff;
            --text-primary-light: #212121;
            --text-secondary-light: #757575;
            --accent-light: #2962ff;
            --accent-light-hover: #0039cb;
            --special-func-light: #e0e0e0;
            --special-func-light-hover: #bdbdbd;
            --shadow-light: rgba(0, 0, 0, 0.15);

            --bg-dark: #121212;
            --surface-dark: #1e1e1e;
            --text-primary-dark: #e0e0e0;
            --text-secondary-dark: #bdbdbd;
            --accent-dark: #448aff;
            --accent-dark-hover: #82b1ff;
            --special-func-dark: #2a2a2a;
            --special-func-dark-hover: #3c3c3c;
            --shadow-dark: rgba(0, 0, 0, 0.5);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            display: grid;
            place-items: center;
            background-color: var(--bg-light);
            color: var(--text-primary-light);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        html.dark-mode {
            --bg: var(--bg-dark);
            --surface: var(--surface-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --accent: var(--accent-dark);
            --accent-hover: var(--accent-dark-hover);
            --special-func: var(--special-func-dark);
            --special-func-hover: var(--special-func-dark-hover);
            --shadow: var(--shadow-dark);
        }
        
        html:not(.dark-mode) {
            --bg: var(--bg-light);
            --surface: var(--surface-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --accent: var(--accent-light);
            --accent-hover: var(--accent-light-hover);
            --special-func: var(--special-func-light);
            --special-func-hover: var(--special-func-light-hover);
            --shadow: var(--shadow-light);
        }

        body {
            background-color: var(--bg);
            color: var(--text-primary);
        }

        .calculator {
            width: 100%;
            max-width: 400px;
            height: 100%;
            max-height: 850px;
            background-color: var(--surface);
            border-radius: 24px;
            box-shadow: 0 10px 30px var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s ease;
        }

        @media (max-width: 420px), (max-height: 870px) {
            .calculator {
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
                box-shadow: none;
            }
        }
        
        .calculator-mode-selector {
            padding: 1rem 1.5rem 0.5rem;
        }

        #mode-select {
            width: 100%;
            padding: 0.5rem;
            border-radius: 8px;
            border: 1px solid var(--special-func);
            background-color: var(--surface);
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
        }

        .calculator-display {
            padding: 1rem 1.5rem 1rem;
            text-align: right;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            flex: 1;
            min-height: 120px;
            overflow: hidden;
        }

        #history {
            min-height: 24px;
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 300;
            white-space: nowrap;
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;
        }
        #history::-webkit-scrollbar { display: none; }

        #expression {
            font-size: 3rem;
            font-weight: 400;
            color: var(--text-primary);
            white-space: nowrap;
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;
        }
        #expression::-webkit-scrollbar { display: none; }

        .programmer-display-conversions {
            display: none;
            flex-wrap: wrap;
            justify-content: space-between;
            padding: 0.5rem 0 0;
            gap: 5px;
        }
        .base-display {
            flex-basis: calc(50% - 5px); display: flex; align-items: baseline; gap: 8px;
        }
        .base-display span { font-size: 0.8rem; color: var(--text-secondary); }
        .base-display p { font-size: 1rem; color: var(--text-primary); font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .calculator-keys {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background-color: var(--special-func);
            padding-top: 1px;
            transition: background-color 0.3s ease;
        }

        .calculator-keys button {
            position: relative; border: none; background-color: var(--surface);
            font-size: 1.4rem; font-weight: 400; color: var(--text-primary);
            padding: 1.2rem 0; cursor: pointer; outline: none; overflow: hidden;
            transition: background-color 0.2s ease, color 0.2s ease, opacity 0.2s ease;
            display: grid; place-items: center; min-height: 65px;
        }
        
        .calculator-keys button:hover {
            background-color: var(--special-func-hover);
        }

        .calculator-keys button.operator, .calculator-keys button.function {
            color: var(--accent); font-weight: 500;
        }

        .calculator-keys button.special-function { background-color: var(--special-func); }
        .calculator-keys button.special-function:hover { background-color: var(--special-func-hover); }

        .calculator-keys button.zero { grid-column: span 2; }
        .calculator-keys button.clear, .calculator-keys button.backspace { grid-column: span 2; }

        .calculator-keys button.equals {
            background-color: var(--accent); color: white; grid-column: span 4;
        }
        .calculator-keys button.equals:hover { background-color: var(--accent-hover); }

        .calculator.basic-mode [data-mode="advanced"],
        .calculator.basic-mode [data-mode="programmer"] { display: none; }
        .calculator.advanced-mode [data-mode="programmer"] { display: none; }
        .calculator.programmer-mode [data-mode="advanced"] { display: none; }
        .calculator.programmer-mode .programmer-display-conversions { display: flex; }

        .calculator.programmer-mode .num-key.disabled,
        .calculator.programmer-mode .hex-key.disabled {
            opacity: 0.4; pointer-events: none;
        }
        .calculator.programmer-mode button[data-key="."] {
            opacity: 0.4; pointer-events: none;
        }
        .calculator.programmer-mode .base-selector.active-base {
            background-color: var(--accent); color: white;
        }
        .calculator.programmer-mode .base-selector.active-base:hover {
            background-color: var(--accent-hover);
        }

        .ripple {
            position: absolute; border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.1);
            transform: scale(0);
            animation: ripple 0.25s linear;
        }
        @keyframes ripple { to { transform: scale(4); opacity: 0; } }

        .data-calculator-view {
            display: none;
            padding: 0;
            height: 100%;
            flex-direction: column;
            justify-content: center;
            gap: 1rem;
        }

        .calculator.data-mode .data-calculator-view { display: flex; }
        .calculator.data-mode #history,
        .calculator.data-mode #expression,
        .calculator.data-mode .programmer-display-conversions { display: none; }
        .calculator.data-mode .calculator-keys { display: none; }
        .calculator.data-mode .calculator-display { padding-bottom: 2rem; }

        .data-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .data-row input[type="number"], .data-row select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--special-func);
            background-color: var(--bg);
            color: var(--text-primary);
            font-size: 1.2rem;
            outline: none;
            transition: border-color 0.2s ease;
        }
        .data-row input[type="number"]:focus, .data-row select:focus {
            border-color: var(--accent);
        }
        .data-row input[type="number"] { flex-grow: 1; }
        .data-row select { flex-basis: 120px; flex-shrink: 0; }
        
        .data-calculator-keys {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            background-color: var(--special-func);
            padding-top: 1px;
        }

        .calculator.data-mode .data-calculator-keys {
            display: grid;
        }

        .data-calculator-keys button {
            position: relative; border: none; background-color: var(--surface);
            font-size: 1.4rem; font-weight: 400; color: var(--text-primary);
            padding: 1.2rem 0; cursor: pointer; outline: none; overflow: hidden;
            transition: background-color 0.2s ease, color 0.2s ease, opacity 0.2s ease;
            display: grid; place-items: center; min-height: 65px;
        }
        .data-calculator-keys button:hover {
            background-color: var(--special-func-hover);
        }
        .data-calculator-keys button.special-function { background-color: var(--special-func); }
        .data-calculator-keys button.special-function:hover { background-color: var(--special-func-hover); }
        .data-calculator-keys button.zero { grid-column: span 2; }
        .data-calculator-keys button.clear { grid-column: span 3; }

    </style>
</head>
<body>
    <div class="calculator">
        <div class="calculator-mode-selector">
            <select id="mode-select">
                <option value="advanced">Scientific</option>
                <option value="basic">Basic</option>
                <option value="programmer">Programmer</option>
                <option value="data">Data Calculation</option>
            </select>
        </div>

        <div class="calculator-display">
            <div id="history"></div>
            <div id="expression">0</div>
            <div class="programmer-display-conversions">
                <div class="base-display"><span>HEX</span><p id="hex-display">0</p></div>
                <div class="base-display"><span>DEC</span><p id="dec-display">0</p></div>
                <div class="base-display"><span>OCT</span><p id="oct-display">0</p></div>
                <div class="base-display"><span>BIN</span><p id="bin-display">0</p></div>
            </div>
            <div class="data-calculator-view">
                <div class="data-row">
                    <input type="number" id="data-input" value="1">
                    <select id="data-input-unit">
                        <option>Bytes</option>
                        <option>KB</option>
                        <option selected>MB</option>
                        <option>GB</option>
                        <option>TB</option>
                        <option>PB</option>
                        <option>mbit</option>
                        <option>gbit</option>
                    </select>
                </div>
                <div class="data-row">
                    <input type="number" id="data-output">
                    <select id="data-output-unit">
                        <option>Bytes</option>
                        <option>KB</option>
                        <option>MB</option>
                        <option>GB</option>
                        <option>TB</option>
                        <option>PB</option>
                        <option selected>mbit</option>
                        <option>gbit</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="calculator-keys">
            <button data-mode="advanced" class="special-function function" data-key="sin">sin</button>
            <button data-mode="advanced" class="special-function function" data-key="cos">cos</button>
            <button data-mode="advanced" class="special-function function" data-key="tan">tan</button>
            <button data-mode="advanced" class="special-function function" data-key="log">log</button>

            <button data-mode="programmer" class="special-function base-selector" data-base="2" data-key="BIN">BIN</button>
            <button data-mode="programmer" class="special-function base-selector" data-base="8" data-key="OCT">OCT</button>
            <button data-mode="programmer" class="special-function base-selector" data-base="10" data-key="DEC">DEC</button>
            <button data-mode="programmer" class="special-function base-selector" data-base="16" data-key="HEX">HEX</button>

            <button data-mode="advanced" class="special-function function" data-key="ln">ln</button>
            <button data-mode="advanced" class="special-function function" data-key="(">(</button>
            <button data-mode="advanced" class="special-function function" data-key=")">)</button>
            <button data-mode="advanced" class="special-function function" data-key="^">x<sup>y</sup></button>

            <button data-mode="programmer" class="special-function hex-key" data-key="A">A</button>
            <button data-mode="programmer" class="special-function hex-key" data-key="B">B</button>
            <button data-mode="programmer" class="special-function hex-key" data-key="C">C</button>
            <button data-mode="programmer" class="special-function operator" data-key="%">%</button>
            
            <button data-mode="advanced" class="special-function function" data-key="sqrt">√</button>
            <button data-mode="advanced" class="special-function" data-key="pi">π</button>
            <button data-mode="advanced" class="special-function" data-key="e">e</button>
            <button data-mode="advanced" class="special-function operator" data-key="%">%</button>

            <button data-mode="programmer" class="special-function hex-key" data-key="D">D</button>
            <button data-mode="programmer" class="special-function hex-key" data-key="E">E</button>
            <button data-mode="programmer" class="special-function hex-key" data-key="F">F</button>
            <button data-mode="programmer" class="special-function" data-key="(">(</button>

            <button class="special-function clear" data-key="clear">C</button>
            <button class="special-function operator backspace" data-key="backspace">⌫</button>
            
            <button class="num-key" data-key="7">7</button>
            <button class="num-key" data-key="8">8</button>
            <button class="num-key" data-key="9">9</button>
            <button class="operator" data-key="/">÷</button>
            
            <button class="num-key" data-key="4">4</button>
            <button class="num-key" data-key="5">5</button>
            <button class="num-key" data-key="6">6</button>
            <button class="operator" data-key="*">×</button>

            <button class="num-key" data-key="1">1</button>
            <button class="num-key" data-key="2">2</button>
            <button class="num-key" data-key="3">3</button>
            <button class="operator" data-key="-">-</button>

            <button data-key="0" class="zero num-key">0</button>
            <button data-key=".">.</button>
            <button class="operator" data-key="+">+</button>
            
            <button class="equals" data-key="=">=</button>
        </div>
        <div class="data-calculator-keys">
            <button class="num-key" data-key="7">7</button>
            <button class="num-key" data-key="8">8</button>
            <button class="num-key" data-key="9">9</button>
            <button class="num-key" data-key="4">4</button>
            <button class="num-key" data-key="5">5</button>
            <button class="num-key" data-key="6">6</button>
            <button class="num-key" data-key="1">1</button>
            <button class="num-key" data-key="2">2</button>
            <button class="num-key" data-key="3">3</button>
            <button class="num-key" data-key="0">0</button>
            <button class="num-key" data-key=".">.</button>
            <button class="special-function backspace" data-key="backspace">⌫</button>
            <button class="special-function clear" data-key="clear">C</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calculator = document.querySelector('.calculator');
            const displayExpression = document.getElementById('expression');
            const displayHistory = document.getElementById('history');
            const keys = document.querySelector('.calculator-keys');
            const modeSelector = document.getElementById('mode-select');
            const conversionDisplays = {
                hex: document.getElementById('hex-display'),
                dec: document.getElementById('dec-display'),
                oct: document.getElementById('oct-display'),
                bin: document.getElementById('bin-display'),
            };

            const dataInput = document.getElementById('data-input');
            const dataInputUnit = document.getElementById('data-input-unit');
            const dataOutput = document.getElementById('data-output');
            const dataOutputUnit = document.getElementById('data-output-unit');
            const dataKeys = document.querySelector('.data-calculator-keys');

            let currentExpression = '';
            let isResultDisplayed = false;
            let currentMode = 'advanced';
            let currentBase = 10;
            let activeDataInput = dataInput;

            const dataConversionFactors = {
                'Bytes': 1,
                'KB': 1024,
                'MB': 1024 ** 2,
                'GB': 1024 ** 3,
                'TB': 1024 ** 4,
                'PB': 1024 ** 5,
                'mbit': 125000,
                'gbit': 125000000
            };

            const matcher = window.matchMedia('(prefers-color-scheme: dark)');
            matcher.addEventListener('change', e => toggleDarkMode(e.matches));
            setMode(modeSelector.value);

            keys.addEventListener('click', event => {
                if (!event.target.matches('button')) return;
                createRipple(event);
                handleKeyPress(event.target.dataset.key);
            });

            document.addEventListener('keydown', event => {
                if (currentMode === 'data') return;
                let key = event.key;
                let dataKey;

                const keyMap = {
                    'Enter': '=', 'Backspace': 'backspace', 'Escape': 'clear',
                    'c': 'clear', 'C': 'clear', '*': '*', 'x': '*', 'X': '*',
                    '/': '/', '+': '+', '-': '-', '.': '.', '%': '%', '^': '^',
                    '(': '(', ')': ')', 's': 'sin', 't': 'tan', 'l': 'log', 'p': 'pi', 'e': 'e'
                };

                if (keyMap[key]) {
                    dataKey = keyMap[key];
                } else if (currentMode === 'programmer' && /^[a-fA-F0-9]$/.test(key)) {
                    dataKey = key.toUpperCase();
                } else if (/^[0-9]$/.test(key)) {
                    dataKey = key;
                } else {
                    return;
                }
                
                const buttons = document.querySelectorAll(`button[data-key='${dataKey}']`);
                let targetButton = null;
                for (const btn of buttons) {
                    if (btn.offsetParent !== null) {
                        targetButton = btn;
                        break;
                    }
                }

                if (targetButton && !targetButton.classList.contains('disabled')) {
                    event.preventDefault();
                    targetButton.click();
                }
            });

            modeSelector.addEventListener('change', (e) => setMode(e.target.value));

            dataInput.addEventListener('input', () => performDataConversion('input'));
            dataInputUnit.addEventListener('change', () => performDataConversion('input'));
            dataOutput.addEventListener('input', () => performDataConversion('output'));
            dataOutputUnit.addEventListener('change', () => performDataConversion('input'));

            dataInput.addEventListener('focus', () => activeDataInput = dataInput);
            dataOutput.addEventListener('focus', () => activeDataInput = dataOutput);

            dataKeys.addEventListener('click', event => {
                if (!event.target.matches('button')) return;
                createRipple(event);
                const key = event.target.dataset.key;
                
                if (key === 'clear') {
                    activeDataInput.value = '';
                } else if (key === 'backspace') {
                    activeDataInput.value = activeDataInput.value.slice(0, -1);
                } else if (key === '.' && activeDataInput.value.includes('.')) {
                    return; 
                } else {
                    activeDataInput.value += key;
                }
                activeDataInput.dispatchEvent(new Event('input', { bubbles: true }));
            });

            function performDataConversion(source = 'input') {
                if (currentMode !== 'data') return;

                let value, fromUnit, toUnit, targetElement;

                if (source === 'input') {
                    value = parseFloat(dataInput.value);
                    fromUnit = dataInputUnit.value;
                    toUnit = dataOutputUnit.value;
                    targetElement = dataOutput;
                } else {
                    value = parseFloat(dataOutput.value);
                    fromUnit = dataOutputUnit.value;
                    toUnit = dataInputUnit.value;
                    targetElement = dataInput;
                }

                if (isNaN(value)) {
                    targetElement.value = '';
                    return;
                }

                const valueInBytes = value * dataConversionFactors[fromUnit];
                const result = valueInBytes / dataConversionFactors[toUnit];
                
                if(result === 0 && value !== 0) {
                     targetElement.value = result.toExponential(9);
                } else {
                     targetElement.value = parseFloat(result.toPrecision(15));
                }
            }

            function setMode(mode) {
                currentMode = mode;
                calculator.className = 'calculator';
                calculator.classList.add(`${mode}-mode`);
                
                if (mode === 'data') {
                    performDataConversion();
                } else {
                    resetCalculator();
                    updateButtonStates();
                }
            }

            function handleKeyPress(key) {
                if (currentMode === 'programmer') {
                    handleProgrammerKeyPress(key);
                } else {
                    handleStandardKeyPress(key);
                }
                updateDisplay();
            }

            function handleStandardKeyPress(key) {
                if (!isNaN(key) || key === '.') handleNumber(key);
                else if (['+', '-', '*', '/', '^', '%'].includes(key)) handleOperator(key);
                else if (['sin', 'cos', 'tan', 'log', 'ln', 'sqrt'].includes(key)) handleFunction(key);
                else if (['pi', 'e'].includes(key)) handleConstant(key);
                else handleSpecialKey(key);
            }

            function handleProgrammerKeyPress(key) {
                const baseSelector = document.querySelector(`.base-selector[data-key="${key}"]`);
                if (baseSelector) {
                    changeBase(parseInt(baseSelector.dataset.base));
                    return;
                }

                if (key === '=' || key === 'Enter') calculate();
                else if (key === 'clear') resetCalculator();
                else if (key === 'backspace') {
                    if (currentExpression.length > 0 && !isResultDisplayed) {
                       currentExpression = currentExpression.slice(0, -1);
                    }
                } else if (['+', '-', '*', '/', '%', '(', ')'].includes(key)) {
                    isResultDisplayed = false;
                    currentExpression += key;
                } else {
                     if (isResultDisplayed) {
                         currentExpression = '';
                         isResultDisplayed = false;
                     }
                    currentExpression += key;
                }
            }

            function handleNumber(key) {
                if (isResultDisplayed) {
                    currentExpression = (key === '.') ? '0.' : key;
                    isResultDisplayed = false;
                } else {
                    currentExpression = (currentExpression === '0' && key !== '.') ? key : currentExpression + key;
                }
            }
            function handleOperator(key) {
                isResultDisplayed = false;
                const lastChar = currentExpression.slice(-1);
                if (['+', '-', '*', '/', '^', '%'].includes(lastChar)) {
                    currentExpression = currentExpression.slice(0, -1) + key;
                } else if (currentExpression !== '') {
                    currentExpression += key;
                }
            }
            function handleFunction(key) {
                if (isResultDisplayed) {
                    currentExpression = '';
                    isResultDisplayed = false;
                }
                currentExpression += key + '(';
            }
            function handleConstant(key) {
                 if (isResultDisplayed) {
                     currentExpression = '';
                     isResultDisplayed = false;
                 }
                const lastChar = currentExpression.slice(-1);
                if (currentExpression === '' || ['+', '-', '*', '/', '(', '^', '%'].includes(lastChar)) {
                    currentExpression += key;
                }
            }
            function handleSpecialKey(key) {
                switch (key) {
                    case '=': calculate(); break;
                    case 'clear': resetCalculator(); break;
                    case 'backspace':
                        if (currentExpression.length > 0 && !isResultDisplayed) {
                            currentExpression = currentExpression.slice(0, -1);
                        }
                        break;
                    case '(': case ')':
                        isResultDisplayed = false;
                        currentExpression += key;
                        break;
                }
            }

            function calculate() {
                if (currentExpression === '' || isResultDisplayed) return;
                
                try {
                    let result;
                    if (currentMode === 'programmer') {
                        result = calculateProgrammer();
                    } else {
                        result = calculateStandard();
                    }
                    displayHistory.textContent = currentExpression + ' =';
                    currentExpression = result.toString();
                    isResultDisplayed = true;
                } catch (error) {
                    displayHistory.textContent = currentExpression + ' =';
                    currentExpression = 'Error';
                    isResultDisplayed = true;
                }
            }

            function calculateStandard() {
                let expr = currentExpression;
                const openParen = (expr.match(/\(/g) || []).length;
                const closeParen = (expr.match(/\)/g) || []).length;
                if (openParen > closeParen) {
                    expr += ')'.repeat(openParen - closeParen);
                }

                let evalExpression = expr
                    .replace(/×/g, '*').replace(/÷/g, '/')
                    .replace(/π/g, 'Math.PI').replace(/e/g, 'Math.E')
                    .replace(/\^/g, '**')
                    .replace(/sqrt\(/g, 'Math.sqrt(')
                    .replace(/log\(/g, 'Math.log10(').replace(/ln\(/g, 'Math.log(')
                    .replace(/sin\(/g, 'Math.sin(Math.PI/180 * ')
                    .replace(/cos\(/g, 'Math.cos(Math.PI/180 * ')
                    .replace(/tan\(/g, 'Math.tan(Math.PI/180 * ');
                
                const result = parseFloat(eval(evalExpression).toFixed(10));
                if (isNaN(result) || !isFinite(result)) throw new Error("Invalid calculation");
                return result;
            }

            function calculateProgrammer() {
                const tokens = currentExpression.match(new RegExp(`[A-F0-9]+|[+\\-*\\/%()]`, 'g')) || [];
                const decimalTokens = tokens.map(token => {
                    if (['+', '-', '*', '/', '%', '(', ')'].includes(token)) return token;
                    return parseInt(token, currentBase);
                });
                const resultDecimal = eval(decimalTokens.join(''));
                return Math.floor(resultDecimal).toString(currentBase).toUpperCase();
            }

            function changeBase(newBase) {
                if (currentBase === newBase) return;
                
                try {
                    const lastNumber = currentExpression.match(/[A-F0-9]+$/);
                    if (lastNumber) {
                        const decimalValue = parseInt(lastNumber[0], currentBase);
                        if (!isNaN(decimalValue)) {
                            currentExpression = currentExpression.substring(0, currentExpression.length - lastNumber[0].length) 
                                              + decimalValue.toString(newBase).toUpperCase();
                        }
                    }
                } catch (e) { /* Ignore conversion errors */ }

                currentBase = newBase;
                updateButtonStates();
                updateDisplay();
            }

            function updateDisplay() {
                displayExpression.textContent = currentExpression === '' ? '0' : currentExpression;
                displayExpression.scrollLeft = displayExpression.scrollWidth;
                if (currentMode === 'programmer') {
                    const lastNumber = (currentExpression.match(/[A-F0-9]+$/) || ['0'])[0];
                    const decimalValue = parseInt(lastNumber, currentBase);
                    updateConversionDisplays(isNaN(decimalValue) ? 0 : decimalValue);
                }
            }
            
            function resetCalculator() {
                currentExpression = '';
                displayHistory.textContent = '';
                isResultDisplayed = false;
                if (currentMode === 'programmer') {
                    currentBase = 10;
                    updateButtonStates();
                }
                updateDisplay();
            }

            function updateButtonStates() {
                if (currentMode !== 'programmer') return;

                const validDigits = '0123456789ABCDEF'.slice(0, currentBase);
                document.querySelectorAll('.num-key, .hex-key').forEach(btn => {
                    const key = btn.dataset.key;
                    if (validDigits.includes(key)) {
                        btn.classList.remove('disabled');
                    } else {
                        btn.classList.add('disabled');
                    }
                });

                document.querySelectorAll('.base-selector').forEach(btn => {
                    btn.classList.remove('active-base');
                    if (parseInt(btn.dataset.base) === currentBase) {
                        btn.classList.add('active-base');
                    }
                });
            }

            function updateConversionDisplays(decimalValue) {
                conversionDisplays.hex.textContent = decimalValue.toString(16).toUpperCase();
                conversionDisplays.dec.textContent = decimalValue.toString(10);
                conversionDisplays.oct.textContent = decimalValue.toString(8);
                conversionDisplays.bin.textContent = decimalValue.toString(2);
            }

            function toggleDarkMode(isDark) {
                document.documentElement.classList.toggle('dark-mode', isDark);
            }
            
            function createRipple(event) {
                const button = event.target;
                const circle = document.createElement("span");
                const diameter = Math.max(button.clientWidth, button.clientHeight);
                const radius = diameter / 2;
                circle.style.width = circle.style.height = `${diameter}px`;

                if (event.detail > 0) {
                    const rect = button.getBoundingClientRect();
                    circle.style.left = `${event.clientX - rect.left - radius}px`;
                    circle.style.top = `${event.clientY - rect.top - radius}px`;
                } else {
                    circle.style.left = `${(button.offsetWidth / 2) - radius}px`;
                    circle.style.top = `${(button.offsetHeight / 2) - radius}px`;
                }
                
                circle.classList.add("ripple");
                circle.addEventListener('animationend', () => circle.remove());
                button.appendChild(circle);
            }
        });
    </script>
</body>
</html>


