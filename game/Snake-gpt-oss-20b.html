<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>贪吃蛇</title>
<style>
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#222;color:#fff;text-align:center;}
  canvas{background:#111;margin-top:20px;}
  #info{margin-top:10px;}
  #over{
    position:absolute;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;
    color:#fff;font-size:1.5em;display:none;flex-direction:column;
  }
  #over button{margin-top:1em;padding:10px 20px;font-size:0.5em;}
</style>
</head>
<body>
<h1>贪吃蛇</h1>
<canvas id="game" width="400" height="400"></canvas>
<div id="info">得分：<span id="score">0</span></div>
<div id="over">
  <div>游戏结束<br>得分：<span id="finalScore">0</span><br><button id="restart">再来一局</button></div>
</div>
<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const size = 20;               // 每格大小
  const cols = canvas.width / size;
  const rows = canvas.height / size;
  let snake = [[10,10]];
  let dir = [1,0];               // 初始方向向右
  let food = [15,15];
  let score = 0;
  let gameInterval;
  let gameOver = false;

  // 绘制
  function draw(){
    ctx.fillStyle = '#111';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    // 蛇
    ctx.fillStyle = '#0f0';
    snake.forEach(p=>ctx.fillRect(p[0]*size,p[1]*size,size,size));
    // 食物
    ctx.fillStyle = '#f00';
    ctx.fillRect(food[0]*size,food[1]*size,size,size);
  }

  // 放置食物
  function placeFood(){
    let fx,fy;
    do{
      fx = Math.floor(Math.random()*cols);
      fy = Math.floor(Math.random()*rows);
    }while(snake.some(p=>p[0]===fx&&p[1]===fy));
    food=[fx,fy];
  }

  // 更新游戏状态
  function update(){
    const newHead = [snake[0][0]+dir[0], snake[0][1]+dir[1]];
    // 边界碰撞
    if(newHead[0] < 0 || newHead[0] >= cols || newHead[1] < 0 || newHead[1] >= rows){
      endGame();return;
    }
    // 自碰撞
    if(snake.some(p=>p[0]===newHead[0] && p[1]===newHead[1])){
      endGame();return;
    }
    snake.unshift(newHead);
    // 吃到食物
    if(newHead[0]===food[0] && newHead[1]===food[1]){
      score++;
      document.getElementById('score').textContent = score;
      placeFood();
    }else{
      snake.pop();
    }
  }

  // 游戏循环
  function loop(){
    update();
    draw();
  }

  // 开始游戏
  function start(){
    snake=[[10,10]];
    dir=[1,0];
    placeFood();
    score=0;
    document.getElementById('score').textContent = score;
    gameOver=false;
    document.getElementById('over').style.display='none';
    clearInterval(gameInterval);
    gameInterval=setInterval(loop,200);
  }

  // 结束游戏
  function endGame(){
    clearInterval(gameInterval);
    gameOver=true;
    document.getElementById('finalScore').textContent = score;
    document.getElementById('over').style.display='flex';
  }

  // 键盘控制
  document.addEventListener('keydown',e=>{
    if(gameOver)return;
    if(e.key==='ArrowUp' && dir[1]!==1) dir=[0,-1];
    else if(e.key==='ArrowDown' && dir[1]!==-1) dir=[0,1];
    else if(e.key==='ArrowLeft' && dir[0]!==1) dir=[-1,0];
    else if(e.key==='ArrowRight' && dir[0]!==-1) dir=[1,0];
  });

  document.getElementById('restart').addEventListener('click',start);
  start();
})();
</script>
</body>
</html>