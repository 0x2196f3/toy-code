<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aircraft Wars – Triangle + Rectangle Edition</title>
<style>
  body{margin:0;background:#000;font-family:Arial;
       display:flex;justify-content:center;align-items:center;height:100vh;color:#fff;}
  #gameContainer{position:relative;width:480px;height:640px;}
  canvas{background:#111;border:1px solid #fff;display:block;}
  #overlay{
      position:absolute;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.6);
      display:flex;flex-direction:column;justify-content:center;align-items:center;
      color:#fff;font-size:24px;}
  #restartBtn{margin-top:20px;padding:10px 20px;font-size:18px;cursor:pointer;}
</style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas" width="480" height="640"></canvas>
  <div id="overlay" style="display:none;">
    <div id="gameOverText"></div>
    <button id="restartBtn">Restart</button>
  </div>
</div>

<script>
/* === Game constants === */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const WIDTH = canvas.width;
const HEIGHT = canvas.height;

const PLAYER_W = 40, PLAYER_H = 40;
const PLAYER_SPEED = 5;
const BULLET_W = 4, BULLET_H = 10;
const BULLET_SPEED = 7;
const ENEMY_W = 40, ENEMY_H = 40;
const ENEMY_SPEED = 2;
const ENEMY_SPAWN_INTERVAL = 1200; // ms
const FIRE_COOLDOWN = 250; // ms

/* === Aircraft shape (triangle + narrow rectangle) === */
const enemyShape = {
  triangle: [
    {x:0, y:0},
    {x:40, y:0},
    {x:20, y:20}          // normal orientation
  ],
  rect: [
    {x:16, y:30},
    {x:24, y:30},
    {x:24, y:-10},
    {x:16, y:-10}
  ]
};

const playerShape = {
  triangle: [
    {x:0, y:15},
    {x:40, y:15},
    {x:20, y:-5}         // upside‑down orientation
  ],
  rect: [
    {x:16, y:30},
    {x:24, y:30},
    {x:24, y:-10},
    {x:16, y:-10}
  ]
};

/* === Game state === */
let player = {x: WIDTH/2 - PLAYER_W/2, y: HEIGHT-50, w: PLAYER_W, h: PLAYER_H};
let bullets = [];
let enemies = [];
let keys = {};
let score = 0;
let lastShot = 0;
let lastEnemySpawn = 0;
let gameOver = false;
let animationId = null;

/* === Utility === */
function rectIntersect(a, b) {
  return !(
    a.x + a.w < b.x ||
    a.x > b.x + b.w ||
    a.y + a.h < b.y ||
    a.y > b.y + b.h
  );
}

/* === Draw aircraft (triangle + rectangle) === */
function drawAircraft(ctx, shape, color, posX, posY) {
  const centerX = 20; // (maxX+minX)/2 = (40+0)/2
  const minY = -10;   // lowest y in the shape
  const offsetX = posX - centerX;
  const offsetY = posY - minY; // posY is the bottom of the aircraft

  ctx.fillStyle = color;

  // Triangle
  ctx.beginPath();
  ctx.moveTo(shape.triangle[0].x + offsetX, shape.triangle[0].y + offsetY);
  for (let i = 1; i < shape.triangle.length; i++) {
    ctx.lineTo(shape.triangle[i].x + offsetX, shape.triangle[i].y + offsetY);
  }
  ctx.closePath();
  ctx.fill();

  // Rectangle
  ctx.beginPath();
  ctx.moveTo(shape.rect[0].x + offsetX, shape.rect[0].y + offsetY);
  for (let i = 1; i < shape.rect.length; i++) {
    ctx.lineTo(shape.rect[i].x + offsetX, shape.rect[i].y + offsetY);
  }
  ctx.closePath();
  ctx.fill();
}

/* === Game logic === */
function spawnEnemy() {
  const x = Math.random() * (WIDTH - ENEMY_W);
  enemies.push({x, y: -ENEMY_H, w: ENEMY_W, h: ENEMY_H});
}

function update() {
  /* Player movement */
  if (keys.left)  player.x -= PLAYER_SPEED;
  if (keys.right) player.x += PLAYER_SPEED;
  if (keys.up)    player.y -= PLAYER_SPEED;
  if (keys.down)  player.y += PLAYER_SPEED;
  player.x = Math.max(0, Math.min(player.x, WIDTH - player.w));
  player.y = Math.max(0, Math.min(player.y, HEIGHT - player.h));

  /* Shooting */
  if (keys.space && Date.now() - lastShot > FIRE_COOLDOWN) {
    bullets.push({
      x: player.x - BULLET_W/2, // + player.w/2 ,
      //y: player.y - BULLET_H,
	  y: player.y + 30 - BULLET_H,
      w: BULLET_W, h: BULLET_H
    });
    lastShot = Date.now();
  }

  /* Bullets */
  bullets.forEach(b => b.y -= BULLET_SPEED);
  bullets = bullets.filter(b => b.y + b.h > 0);

  /* Enemies */
  enemies.forEach(e => e.y += ENEMY_SPEED);
  enemies = enemies.filter(e => e.y < HEIGHT);

  /* Collisions */
  bullets.forEach(b => {
    enemies.forEach(e => {
      if (rectIntersect(b, e)) {
        b.hit = true; e.hit = true;
        score += 10;
      }
    });
  });
  bullets = bullets.filter(b => !b.hit);
  enemies = enemies.filter(e => !e.hit);

  /* Enemy-player collision */
  enemies.forEach(e => {
    if (rectIntersect(e, player)) gameOver = true;
  });

  /* Enemy spawn */
  if (Date.now() - lastEnemySpawn > ENEMY_SPAWN_INTERVAL) {
    spawnEnemy();
    lastEnemySpawn = Date.now();
  }
}

function draw() {
  ctx.clearRect(0,0,WIDTH,HEIGHT);

  /* Player */
  drawAircraft(ctx, playerShape, '#0f0', player.x, player.y);

  /* Bullets */
  ctx.fillStyle = '#ff0';
  bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

  /* Enemies */
  enemies.forEach(e => {
    drawAircraft(ctx, enemyShape, '#f00', e.x, e.y);
  });

  /* Score */
  ctx.fillStyle = '#fff';
  ctx.font = '20px Arial';
  ctx.fillText('Score: '+score, 10, 25);
}

/* === Game loop === */
function gameLoop() {
  if (gameOver) {
    cancelAnimationFrame(animationId);
    showOverlay();
    return;
  }
  update();
  draw();
  animationId = requestAnimationFrame(gameLoop);
}

/* === UI === */
function showOverlay() {
  document.getElementById('gameOverText').textContent = `Game Over\nScore: ${score}`;
  document.getElementById('overlay').style.display = 'flex';
}

function resetGame() {
  player = {x: WIDTH/2 - PLAYER_W/2, y: HEIGHT-50, w: PLAYER_W, h: PLAYER_H};
  bullets = [];
  enemies = [];
  keys = {};
  score = 0;
  lastShot = 0;
  lastEnemySpawn = 0;
  gameOver = false;
  document.getElementById('overlay').style.display = 'none';
  gameLoop();
}

/* === Event listeners === */
window.addEventListener('keydown', e => {
  switch (e.code) {
    case 'ArrowLeft':  keys.left = true; break;
    case 'ArrowRight': keys.right = true; break;
    case 'ArrowUp':    keys.up = true; break;
    case 'ArrowDown':  keys.down = true; break;
    case 'Space':      keys.space = true; break;
  }
});

window.addEventListener('keyup', e => {
  switch (e.code) {
    case 'ArrowLeft':  keys.left = false; break;
    case 'ArrowRight': keys.right = false; break;
    case 'ArrowUp':    keys.up = false; break;
    case 'ArrowDown':  keys.down = false; break;
    case 'Space':      keys.space = false; break;
  }
});

document.getElementById('restartBtn').addEventListener('click', resetGame);

/* === Start === */
resetGame(); // initialize and start
</script>
</body>
</html>
